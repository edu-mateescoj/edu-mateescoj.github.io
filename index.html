<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Exerciseur Python</title>
    <style>
        .exercise-container {
            margin: auto;
            width: 50%;
            border: 1px solid #ddd;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        input[type="text"], input[type="range"] {
            padding: 10px;
            margin-right: 5px; /* Spacing between input and checkbox */
            flex: 1 0 auto;
        }/*
        input[type="text"] {
            padding: 10px;
            margin-right: 5px;
            flex: 1 0 auto;
        }
        input [type="range"] {
            padding: 10px;
            margin-right: 5px;
            flex: 1 0 auto;
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #28a745;
            outline: none;
            transition: background 0.3s;
            }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
        }*/

        input[type="checkbox"] {
            margin-right: 5px;
        }
        /*button {
            padding: 10px 15px;
            margin-right: 5px;
            border: none;
            background-color: #5cb85c;
            color: white;
            cursor: pointer;
        }*/
        .button-new-exercise {
            background-color: #007BFF; /* Blue for new exercise */
            color: white;
        }

        .button-verify {
            background-color: #28a745; /* Green for verify */
            color: white;
        }

        .button-show-answers {
            background-color: #6c757d; /* Gray for show answers */
            color: white;
        }

        button:hover {
            opacity: 0.8;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
        }
        label {
            margin-right: 10px; /* Ensure spacing */
        }
    </style>
    <link rel="icon" href="C:\Users\julien\Downloads\favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="exercise-container">
        <h2>Exercices automatiques d'assignation de variables</h2>
        <p>Que valent les variables à la fin de l'exécution du code Python ci-dessous ?</p>
        <pre id="code-display">Exemple de code</pre>

        <label for="numVariables">Nombre de variables (2 à 5):</label>
        <input type="range" id="numVariables" min="2" max="5" value="3" oninput="handleRangeChange(this.value);">
        <span id="variableCount">3</span>
        
        <button id="verify-button" class="button-verify">Vérifier</button>
        <button id="show-button" class="button-show-answers">Montrer les réponses</button>
        <button id="generate-button" class="button-new-exercise">Nouvel exercice</button>
    </div>
    <script>
    const variableNamesWithTypes = {
        anglais: {
            age: "integer", name: "string", userScore: "integer", count: "integer",
            total: "float", sum: "float", product: "float", average: "float",
            max: "float", min: "float", height: "float", width: "float",
            length: "float", size: "integer", position: "integer", status: "string",
            color: "string", date: "string", flag: "boolean", isActive: "boolean",
            hasItems: "boolean", isVisible: "boolean"
        },
        operators: {
            arithmetique: ["+", "-", "*", "//", "%"],
            logique: ["and", "or", "not"],
            comparaison: ["==", "!=", "<", ">", "<=", ">="]
        }
    };

    let numVariables = 3; // Default number of variables

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('generate-button').addEventListener('click', generateDynamicExercise);
        document.getElementById('verify-button').addEventListener('click', verifyAnswers);
        document.getElementById('show-button').addEventListener('click', showAnswers);
        generateDynamicExercise(); // Initial call to populate the exercise
    });

    function handleRangeChange(value) {
        updateVariableCount(value);
        updateRangeColor(value);
    }

    function updateVariableCount(value) {
        document.getElementById('variableCount').textContent = value;
        numVariables = parseInt(value);
    }

    function updateRangeColor(value) {
        const max = parseInt(document.getElementById('numVariables').max);
        const min = parseInt(document.getElementById('numVariables').min);
        const fraction = (value - min) / (max - min);
        // Interpoler entre vert (0,255,0) et rouge (255,0,0)
        const red = Math.round(255 * fraction);
        const green = Math.round(255 * (1 - fraction));
        const blue = 0;
        document.getElementById('numVariables').style.background = `rgb(${red},${green},${blue})`;
        //document.getElementById('variableCount').textContent = value;
    }

    function generateDynamicExercise() {
        const container = document.querySelector('.exercise-container');
        const display = document.getElementById('code-display');
        container.querySelectorAll('.input-group').forEach(el => el.remove());

        const variableNames = Object.keys(variableNamesWithTypes.anglais);
        let selectedVariables = [];
        let variables = {};
        let expressions = [];
        currentCorrectAnswers = {};

        // Initialize variables with appropriate types and values
        while (selectedVariables.length < numVariables) {
            const randomIndex = Math.floor(Math.random() * variableNames.length);
            const variable = variableNames[randomIndex];
            if (!selectedVariables.includes(variable)) {
                selectedVariables.push(variable);
                variables[variable] = initializeVariable(variableNamesWithTypes.anglais[variable]);
                expressions.push(`${variable} = ${formatValueForDisplay(variables[variable])}`);
            }
        }

        // Generate expressions respecting variable types
        selectedVariables.forEach((variable, index) => {
            const inputId = `inputValue${index + 1}`;
            const errorCheckboxId = `errorCheckbox${index + 1}`;

            const inputGroup = document.createElement('div');
            inputGroup.className = 'input-group';

            const labelElement = document.createElement('label');
            labelElement.htmlFor = inputId;
            labelElement.textContent = `Valeur finale de ${variable}:`;

            const inputElement = document.createElement('input');
            inputElement.type = 'text';
            inputElement.id = inputId;
            inputElement.placeholder = `Valeur finale de ${variable}`;

            const errorCheckbox = document.createElement('input');
            errorCheckbox.type = 'checkbox';
            errorCheckbox.id = errorCheckboxId;
            const errorLabel = document.createElement('label');
            errorLabel.htmlFor = errorCheckboxId;
            errorLabel.textContent = "Erreur de division par zéro?";

            inputGroup.appendChild(labelElement);
            inputGroup.appendChild(inputElement);
            inputGroup.appendChild(errorCheckbox);
            inputGroup.appendChild(errorLabel);

            container.appendChild(inputGroup);

            // Generate logical or arithmetic expressions based on variable type
            const isBoolean = variableNamesWithTypes.anglais[variable] === "boolean";
            const operatorSet = isBoolean ? variableNamesWithTypes.operators.logique : variableNamesWithTypes.operators.arithmetique;
            const operator = operatorSet[Math.floor(Math.random() * operatorSet.length)];
            let otherVariable, expression, evalResult;

            if (isBoolean && operator === "not") {
                expression = `${variable} = not ${variable}`;
                evalResult = !variables[variable];
            } else {
                otherVariable = selectAppropriateVariable(selectedVariables, variables, variable, isBoolean);
                const valueToUse = otherVariable ? variables[otherVariable] : getRandomBoolean();
                expression = `${variable} = ${variable} ${operator} ${formatValueForDisplay(valueToUse)}`;
                evalResult = evaluateExpression(variables[variable], valueToUse, operator);
            }

            expressions.push(expression);
            variables[variable] = evalResult;
            currentCorrectAnswers[inputId] = typeof evalResult === 'boolean' ? formatValueForDisplay(evalResult) : evalResult.toString();
        });

        display.textContent = expressions.join('\n');
    }

    function initializeVariable(type) {
        switch(type) {
            case "integer":
            case "float":
            case "string": //on verra plus tard pour les op sur string
                return Math.floor(Math.random() * 21) - 10;
            case "boolean":
                return Math.random() < 0.5;
            default:
                return null; // This should not happen
        }
    }

    function formatValueForDisplay(value) {
        if (typeof value === 'boolean') {
            return value ? "True" : "False";
        }
        return value;
    }

    function selectAppropriateVariable(variables, values, currentVariable, isBoolean) {
        return variables.filter(v => v !== currentVariable && typeof values[v] === (isBoolean ? 'boolean' : 'number'))[0];
    }

    function getRandomBoolean() {
        return Math.random() < 0.5;
    }

    function evaluateExpression(left, right, operator) {
        try {
            switch(operator) {
            case "and":
                return left && right;
            case "or":
                return left || right;
            case "not":
                return !left; // This should be handled outside since it's unary
            case "+":
            case "-":
            case "*":
                return eval(`${left} ${operator} ${right}`);
            case "//":
                if (right === 0) return "Error: Division by zero";
                return Math.floor(left / right);
            case "%":
                if (right === 0) return "Error: Division by zero";
                return left % right;
            default:
                return eval(`${left} ${operator} ${right}`);
        }
        } catch (e) {
            console.error('oups...:', e.message);
            return "Error: Invalid expression";
        
        }
    }

    function verifyAnswers() {
    document.querySelectorAll('.input-group').forEach(group => {
        const input = group.querySelector('input[type="text"]');
        const errorCheckbox = group.querySelector('input[type="checkbox"]');
        const userAnswer = input.value.trim();
        const correctAnswer = currentCorrectAnswers[input.id];
        
        if (errorCheckbox.checked){
            if (correctAnswer === "Error: Division by zero" && userAnswer === "") {
                input.style.backgroundColor = 'lightgreen';  // Correctly predicted error
            } else if (correctAnswer === "Error: Division by zero") {   //aurait pas dû rentrer valeur
                input.style.backgroundColor = '';  // contradiction enter checkBox et valeur
            } else {
                input.style.backgroundColor = 'salmon';  // Incorrect answer or error not predicted
            }}
            else {
                if (userAnswer === "") {
                    input.style.backgroundColor = "";
                } else if (userAnswer === correctAnswer) {
                    input.style.backgroundColor = 'lightgreen';  // Correct answer
                } else {
                    input.style.backgroundColor = 'salmon';  // Incorrect answer
                }
            }
        });
    }
    function showAnswers() {
        document.querySelectorAll('.input-group').forEach(group => {
            const input = group.querySelector('input[type="text"]');
            const errorCheckbox = group.querySelector('input[type="checkbox"]');
            if (currentCorrectAnswers[input.id].startsWith("Error")) {
                errorCheckbox.checked = true;
                input.value = "";  // Clear the input as it's an error
                input.style.backgroundColor = 'lightgray';
            } else {
                input.value = currentCorrectAnswers[input.id];
                input.style.backgroundColor = 'lightgray';
            }
        });
    }
    </script>
</body>
</html>
